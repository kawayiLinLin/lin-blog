---
title: 如何基于hexo搭建一个博客系统
date: 2021-05-07 18:00:52
tags: 教程
---

![](hexo-logo.svg)


*心血来潮，想基于 `hexo` 搭一个静态博客*

## 如何开始

首先查阅文档，见：[hexo中文文档](https://hexo.io/zh-cn/docs/)，文档应该会给出快速搭建的说明

全局安装 `hexo`

```shell
npm install -g hexo
```
初始化项目
```shell
hexo init xxxx
cd xxxx
```


## 想要实现的效果

向仓库推送代码后博客立即更新

我使用的代码仓库是 `coding` ，`coding` 仓库有推送代码时会触发的钩子，在这时它能告知我更新当前的项目文件并重新执行 `hexo` 的相关命令
在仓库配置的信息如图所示 ![](coding_webhook.png) 可以看到，在我每次向 `master` 分支推送代码时， `coding` 仓库会向 `https://yzl.xyz/deploy` 发送一条 `post` 请求

于是我们写一个服务端，用于响应这个 `post` 请求，顺便处理博客的更新，另外这个服务端还作会用于静态资源的响应

## 服务端

首先我们经过查阅文档和实验，知道了 `hexo d` 命令会生成一个 `public` 文件夹，里面存放着博客首页的 `html` 文件及对应的若干静态资源

![](publicthings.png)

> 这里注意 _config.yml 的配置中 permalink 的值结尾要设置为 .html 方便后续创建静态服务

使用 node 创建服务的最快的方式是用库，原生的模块不好用，而且 api 不好记，于是我们 安装 express 搭建一个非常简单的服务


```javascript
const express = require('express')

const app = express()

app.use('/lin/', express.static('./public'))

app.get('/', function(_req, res) {
    res.redirect('/lin')
})

app.get('/lin', function(_req, res) {
    res.sendFile(require('path').join(__dirname, './public/index.html'))
})

const privateKey = fs.readFileSync('./4388799_yzl.xyz.key', 'utf8')

const certificate = fs.readFileSync('./4388799_yzl.xyz.pem', 'utf8')

const credentials = { key: privateKey, cert: certificate }

const https = require('https').Server(credentials, app)

https.listen(443, function() {
  console.log('listening on *:443')
})
```


```javascript 响应 coding 的 webhook
app.post('/deploy', function(_req, res) {
    console.log('start')
    const child_process = require('child_process')
    child_process.exec('chmod +x ./deploy.sh')
    child_process.execFile('./deploy.sh', function(error, stdout,  stderr) {
        if (error) {
            console.log(error)
        }
        if (stdout) {
            console.log(stdout)
        }
        if (stderr) {
            console.log(stderr)
        }
    })
    console.log('end')
    res.end()
})
```


```shell deploy.sh
{
    git pull origin master
    rm -rf ./public
    hexo d
}
echo '执行完毕'
```