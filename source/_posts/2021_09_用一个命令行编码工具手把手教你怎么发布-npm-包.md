---
title: 用一个命令行编码工具手把手教你怎么发布 npm 包
date: 2021-09-12 21:15:39
category:
  - 技术
  - 教程
tags:
  - npm
---

先放 npm 包链接：[https://www.npmjs.com/package/command-base64-encoding](https://www.npmjs.com/package/command-base64-encoding)
[https://www.npmjs.com/package/command-encoding](https://www.npmjs.com/package/command-encoding)

## 初始化

首先，创建一个 git 仓库用于代码版本管理

```shell
git init -y
```

初始化 npm 项目

```shell
npm init -y
```

在生成的 `package.json` 文件中，配置包名 `package.name` ，叫做 `command-encoding`，然后设置 `license`、`author`、`repository` 等字段的信息

对 npm 来说，要实现命令行工具很简单，我们只需要在 `package.json` 文件中增加一个 `bin` 字段，key 为你的命令，value 为对应的入口文件

比如：

```json
{
    "bin": {
        "ce": "./bin/command-encoding.js",
        "command-encoding": "./bin/command-encoding.js"
    }
}
```

<!-- more -->

之后我们在项目根目录中新建 bin 文件夹，并在其中新建 command-encoding.js 文件

此文件第一行需要写一行注释 `#! /usr/bin/env node`

为了方便调试，我们需要执行 `npm link` 命令，让 npm 为我们创建一个软链接，将当前目录软链到 npm 全局文件夹中，同时在 npm 的全局文件夹中自动生成 ce.exe (windows 中) command-encoding.exe 两个可执行文件，当我们在终端中执行 `ce` 命令时，就是在用 node 执行 `./bin/command-encoding.js` 文件

## 命令参数解析


作为一个命令行工具，自然少不了命令的参数解析

在 node 中，用 node 执行脚本文件时，参数等信息都可以从 process 对象上获取，如 `process.argv`，但是这太麻烦了，当然是用别人写好的包来解析命令和参数比较好

我们安装 `commander` 模块

```shell
npm install commander -S
```

怎么使用呢？
首先引入，然后拿到它的实例 `program`

```js
const { Command } = require("commander")
const program = new Command()
```

之后注册命令和参数

```js
// 注册命令
const command = commandprogram.command("encode")
command.option( // 注册参数
    "-t, --type <encoding type>", // 参数简略写法和全称可由逗号等分割符隔开
    "填一个编码类型", // 这是参数的描述
    "base64" // 这是参数的默认值
)
command.action(options => { // 当触发这个命令时要执行的逻辑
    console.log(options)
})
```

最后是解析参数，调用

```js
program.parse()
```

我们在命令行试一试

```shell
ce --help # 显示帮助
ce encode --help # 显示 encode 的命令的用法

ce encode -t base64 # 控制台打印 { type: 'base64' }
```

既然我们要手写一个 base64 编码器的话，那还得需要一个输入参数

```js
command.option( // 在上面再注册参数
    "-i, --input <encoding input>",
    "需要转码的字符串",
)
```

验证一下 `ce encode -t base64 -i 这是测试base64编码`，打印 `{ type: 'base64', input: '这是测试base64编码' }`

## base64 编码

让我们来复习一下 base64 编码

我们知道每个字符都可以用二进制表示，一个字节就是 8 位二进制数

如：`这是测试base64编码`，就可以解析成

```txt
这 11101000 10111111 10011001
是 11100110 10011000 10101111
测 11100110 10110101 10001011
试 11101000 10101111 10010101
b 01100010
a 01100001
s 01110011
e 01100101
6 00110110
4 00110100
编 11100111 10111100 10010110
码 11100111 10100000 10000001
```

base64 编码其实就是对二进制数据进行操作，将每三个字节分为一组，一共 24 位二进制数，每组再分成四份，一份 6 位二进制数

为什么一份是 6 位呢，因为 6 位二进制数正好可以表示不大于 64 的十进制数，在命令行 node 中计算一下

![](node-not-over-64-example.jpg)

base64 的标准编码表是由 26 个大写字母，26 个小写字母，0 - 9，以及 + / 共64个字符组成，分别代表十进制数 0 - 十进制数 63

因此如果转换后的二进制数得到的十进制数为 0 20 30 61 25 10，那么对应的编码应该为 ATd9YJ